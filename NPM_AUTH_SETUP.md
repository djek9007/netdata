# Настройка авторизации Netdata в Nginx Proxy Manager

Этот гайд описывает, как добавить базовую HTTP-аутентификацию для Netdata в Nginx Proxy Manager.

## Быстрый старт (5 минут)

### Шаг 1: Создайте Access List в NPM

1. Откройте интерфейс Nginx Proxy Manager (обычно `http://localhost:81`)
2. Перейдите в меню **Access List** (слева внизу)
3. Нажмите **Add Access List**
4. Заполните:
   - **Name:** `netdata-auth` (или любое имя)
   - **Satisfy:** `Any` (оставить по умолчанию)
5. В разделе **Authorization** выберите **Basic Auth**
6. Нажмите **Add Authorization** и заполните:
   - **Login Name:** `admin` (или ваш логин)
   - **Password:** `your_secure_password` (установите надёжный пароль)
   - Нажмите **Save**
7. Нажмите **Save** для Access List

### Шаг 2: Привяжите Access List к Netdata хосту

1. Перейдите в **Proxy Hosts** (основное меню)
2. Найдите хост для Netdata (например, `netdata.example.com`)
3. Нажмите на него для редактирования
4. Перейдите на вкладку **Access**
5. В поле **Access List** выберите созданный `netdata-auth`
6. Нажмите **Save**

### Шаг 3: Проверьте авторизацию

1. Откройте в браузере `https://netdata.example.com` (или ваш домен)
2. Должно появиться окно с запросом логина/пароля
3. Введите учётные данные из шага 1
4. Готово! Теперь Netdata защищён авторизацией

---

## Альтернатива: Использование файла .htpasswd (для продвинутых)

Если вы хотите управлять пользователями более гибко:

### Генерация .htpasswd файла

**На Linux/Mac:**
```bash
# Установите apache2-utils если не установлены
sudo apt-get install apache2-utils

# Создайте файл с пользователем
htpasswd -c /path/to/htpasswd admin
# Введите пароль дважды

# Добавьте еще пользователей (без -c флага)
htpasswd /path/to/htpasswd user2
htpasswd /path/to/htpasswd user3
```

**На Windows (PowerShell):**
```powershell
# Установите htpasswd через chocolatey или используйте онлайн генератор:
# https://www.htaccesstools.com/htpasswd-generator/

# Или скопируйте готовый файл
```

### Загрузка в NPM

1. В Access List выберите вкладку **Files** вместо **Basic Auth**
2. Загрузите созданный `.htpasswd` файл
3. Сохраните

---

## Рекомендации безопасности

- ✅ **Используйте HTTPS** (NPM должен использовать SSL сертификаты, лучше Let's Encrypt)
- ✅ **Установите сложный пароль** (минимум 12 символов, с буквами/цифрами/спецсимволами)
- ✅ **Регулярно меняйте пароль** (хотя бы раз в 3 месяца)
- ✅ **Если используете несколько пользователей**, настройте разные Access List для разных сервисов
- ❌ **Не публикуйте пароли** в конфиг-файлах, которые коммитятся в git

---

## Часто задаваемые вопросы

### Q: Как изменить пароль?
**A:** 
1. Перейдите в **Access List** → выберите ваш список
2. Нажмите **Edit** на Authorization
3. Измените пароль
4. Нажмите **Save**

### Q: Можно ли добавить нескольких пользователей?
**A:** Да! Нажмите **Add Authorization** в том же Access List и добавьте следующего пользователя. Все пользователи смогут войти с их логинами.

### Q: Авторизация не работает
**A:** 
- Проверьте, что Access List привязан к хосту (вкладка **Access**)
- Убедитесь, что Netdata контейнер доступен на `http://netdata:19999`
- Перезагрузите NPM: `docker-compose restart nginx-proxy-manager` (в папке NPM)
- Проверьте логи: `docker logs nginx-proxy-manager`

### Q: Как отключить авторизацию если она больше не нужна?
**A:**
1. Перейдите в **Proxy Hosts** → ваш хост Netdata
2. Вкладка **Access** → в поле **Access List** выберите `(None)`
3. Нажмите **Save**

---

## Интеграция с docker-compose.npm-only.yml

Если вы используете конфиг из этого репозитория:

```bash
# Проверьте, что контейнер netdata работает
docker ps --filter "name=netdata"

# Логи Netdata (если что-то не так)
docker logs netdata

# Логи NPM (если авторизация не срабатывает)
docker logs nginx-proxy-manager
```

---

## Следующие шаги

После настройки авторизации в NPM:

1. **Тестируйте доступ** — откройте Netdata в приватном окне браузера
2. **Установите SSL сертификат** — в NPM добавьте Let's Encrypt (обычно автоматически)
3. **Настройте другие сервисы** — используйте тот же Access List или создавайте отдельные для каждого сервиса
4. **Резервная копия** — экспортируйте конфиг NPM на случай проблем

---

Если возникнут проблемы, опишите ошибку — помогу разобраться!
